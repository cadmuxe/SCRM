{% macro cal(prepop) -%}
<form class="form-horizontal">

    <p>
        <input type="text" class="input-large" placeholder="无标题活动" id="contact_title">
        <label class="checkbox inline">
            <input type="checkbox" id="allDay" value="option1"> 全天
        </label>
    </p>
    <p><input type="text" class="input-small datepicker" id="contact_start_date">
        <input type="text" class="input-mini" id="contact_start_time">至
        <input type="text" class="input-small datepicker" id="contact_end_date">
        <input type="text" class="input-mini" id="contact_end_time">
    </p>
    <hr>
    <h4>活动详情</h4>
    <p>地点<input type="text" class="input-large"  id="contact_location"></p>
    <p>
        类型 <select class="input-small" id="contact_type" name="contact_type">
        {% for i in g.dbs.tags("contact_type").get_tags() %}
        <option value="{{i|safe}}">{{i|safe}}</option>
        {% endfor %}
    </select>
        花费<input class="input-mini"  id="contact_spend"  type="text">
    </p>

    <p>参与人<input class="input-large" type="text" id="contact_attend"></p>
    <hr>
    <p>说明</br><textarea type="text" class="input-xlarge"  id="contact_remark"></textarea></p>
</form>

<script type="text/javascript" src="/static/js/jquery.timePicker.min.js"></script>
<script>
    $(function() {
        var tn = new Date();
        var s = tn.getFullYear().toString() + '-' + (tn.getMonth()+1).toString() + '-' + tn.getDate().toString();
        $(".datepicker").val(s);
        $("#contact_start_time").val((tn.getHours()+1).toString() + ":00");
        $("#contact_end_time").val((tn.getHours()+2).toString() + ":00");
        $( ".datepicker" ).datepicker({ dateFormat: "yy-mm-dd",showButtonPanel: true});


        $("#contact_start_time, #contact_end_time").timePicker({
                    show24Hours: true,
                    separator: ':',
                    step: 30}
        );
        var oldTime = $.timePicker("#contact_start_time").getTime();
        $('#contact_start_date').change(function(){
           $('#contact_end_date').val($('#contact_start_date').val());
        });
        $("#contact_start_time").change(function() {
            if ($("#contact_end_time").val()) {
                var duration = ($.timePicker("#contact_end_time").getTime() - oldTime);
                var time = $.timePicker("#contact_start_time").getTime();
                $.timePicker("#contact_end_time").setTime(new Date(new Date(time.getTime() + duration)));
                oldTime = time;
            }
        });

        $( "#contact_attend" ).tokenInput({{g.dbs.get_json_customer_and_id_list()|safe}},
                {
                    theme: "facebook",
                    searchDelay:100,
                    {% if customer%}
                    prePopulate:[{_id:'{{customer['_id']|safe}}',name:'{{customer['name']|safe}}'}],
                    {% endif%}
                }
        );
        $( "#selectable" ).selectable();
    });
    var forms_cal={};
    function set_cal(cal){
        forms_cal =cal;
        $("#contact_title").val(forms_cal.title);
        $('#contact_start_date').val(forms_cal.start.split(' ')[0])
        $("#contact_start_time").val(forms_cal.start.split(' ')[1])
        $('#contact_end_date').val(forms_cal.end.split(' ')[0])
        $("#contact_end_time").val(forms_cal.end.split(' ')[1])
        $('#allDay').prop("checked", forms_cal.allDay);
        $("#contact_location").val(forms_cal.location);
        $('#contact_type').val(forms_cal.contact_type);
        $("#contact_spend").val(forms_cal.spending);
        $("#contact_remark").val(forms_cal.remark);
        $( "#contact_attend").tokenInput("clear");
        for(i in forms_cal.attend){
            $( "#contact_attend").tokenInput("add",forms_cal.attend[i]);
        }
    }
    function new_cal(){
        var cal={};
        cal.type = "事务";
        cal.manager = "{{ session['_id'] }}";
        cal.attend = [];
        cal.title = '';
        cal.start = '';
        cal.end = '';
        cal.allDay = true;
        cal.location = '';
        cal.contact_type = '';
        cal.spending = '';
        cal.remark = '';
        cal.finished= false;
        return cal;
    }
    function forms_get_cal(){
        forms_cal.type = "事务";
        forms_cal.manager = "{{ session['_id'] }}";
        var tokens = $( "#contact_attend" ).tokenInput('get');
        forms_cal.attend = tokens;
        forms_cal.title = $("#contact_title").val();
        t_start = $("#contact_start_date").val() + " " + $("#contact_start_time").val();
        // convert local time to gmt time
        forms_cal.start = t_start;
        t_end = $("#contact_end_date").val() + " " + $("#contact_end_time").val();
        forms_cal.end = t_end;
        forms_cal.allDay = $('#allDay').is (':checked');
        forms_cal.location = $("#contact_location").val();
        forms_cal.contact_type = $('#contact_type option:selected').val();
        forms_cal.spending = $("#contact_spend").val();
        forms_cal.remark = $("#contact_remark").val();
        var t_s = new Date(t_start);
        var t_n = new Date();
        if ((t_n-t_s)>600000){
            forms_cal.finished = true;
        }
        else{
            forms_cal.finished = false;
        }

        return forms_cal;
    }
    function get_cal_new(){
        forms_cal =new_cal();
        return forms_get_cal();
    }
    function get_cal_update(){
        return forms_get_cal();
    }
</script>


{%- endmacro %}









{% macro project() -%}
<form class="form-horizontal">

    <div class="control-group">
        <label class="control-label" for="issuer">发行方</label>
        <div class="controls">
            <input type="text" class="input-large" placeholder="发行方" id="issuer">
        </div>
    </div>
    <div class="control-group">
        <label class="control-label" for="project_name">项目名</label>
        <div class="controls">
            <input type="text" class="input-large" placeholder="项目名" id="project_name">
        </div>
    </div>
    <div class="control-group">
        <label class="control-label">行业</label>
        <input type="text" class="input-medium mydata" id="project_sector" placeholder="行业">
    </div>
    <hr>
    <div class="control-group">
        <label class="control-label">发行总额</label>
        <input type="text" class="input-medium mydata" id="scale" placeholder="发行总额">
    </div>
    <div class="control-group">
        <label class="control-label">分红</label>
        <input type="text" class="input-medium mydata" id="income_distribution" placeholder="分红">
    </div>
    <div class="control-group">
        <label class="control-label">项目时长</label>
        <div class="controls input-append">
            <input type="text" class="input-medium mydata" id="length_project" placeholder="时长"><span class="add-on">年</span>
        </div>
    </div>
    <hr>
    <div class="control-group">
        <label class="control-label">备注</label>
        <textarea type="text" class="input-xlarge"  id="remark"></textarea>
    </div>
</form>

<script>
    $(function() {

    });
    var form_project ={};

    function form_get_project(){
        form_project.issuer = $('#issuer').val();
        form_project.manager = "{{ session['_id'] }}";
        form_project.project_name = $("#project_name").val();
        form_project.working = true;
        form_project.project_sector = $('#project_sector').val();
        form_project.scale = $('#scale').val();
        form_project.income_distribution = $('#income_distribution').val();
        form_project.length_project = $('#length_project').val();
        form_project.remark = $('#remark').val();
        return form_project;
    }
    function new_project(){
        var project={}
        project.issuer = "";
        project.manager = "{{ session['_id'] }}";
        project.project_name = "";
        project.working = true;
        project.project_sector = "";
        project.scale = "";
        project.income_distribution ="";
        project.length_project = "";
        project.remark = "";
        return project;
    }
    function set_project(project){
        $('#issuer').val(project.issuer);
        $("#project_name").val(project.project_name);
        $('#project_sector').val(project.project_sector);
        $('#scale').val(project.scale);
        $('#income_distribution').val(project.income_distribution);
        $('#length_project').val(project.length_project);
        $('#remark').val(project.remark);
    }

</script>


{%- endmacro %}














{% macro contract(customer) -%}
<form class="form-horizontal">

    <div class="control-group">
        <label class="control-label" for="issuer">签约日期</label>
        <div class="controls">
            <input type="text" class="input-small datepicker" id="contract_date">
        </div>
    </div>
    <div class="control-group">
        <label class="control-label" for="project_name">项目名</label>
        <div class="controls">
            <input type="text" class="input-large" placeholder="项目名" id="contract_project">
        </div>
    </div>
    <hr>
    <div class="control-group">
        <label class="control-label">合同开始日期</label>
        <div class="controls">
            <input type="text" class="input-small datepicker" id="contract_start_date">
        </div>
    </div>
    <div class="control-group">
        <label class="control-label">合同结束日期</label>
        <div class="controls">
            <input type="text" class="input-small datepicker" id="contract_end_date">
        </div>
    </div>
    <div class="control-group">
        <label class="control-label">合同金额</label>
        <div class="controls">
            <div class="input-append">
                <input type="text" class="input" placeholder="金额" id="amount"><span class="add-on">万元</span>
            </div>
        </div>
    </div>
    <hr>
    <div class="control-group">
        <label class="control-label">备注</label>
        <textarea type="text" class="input-xlarge"  id="remark"></textarea>
    </div>
</form>

<script>
    $(function() {
        $( ".datepicker" ).datepicker({ dateFormat: "yy-mm-dd" });
        var projects  ={{g.dbs.get_json_working_project_list()|safe}};
        $('#contract_project').typeahead({source:projects,items:5,matcher:mymatcher_t})
    });

    function get_contract(){
        var contract={};
        contract.user_id = "{{customer['_id']|safe}}";
        contract.manager = "{{ session['_id'] }}";
        contract.contract_date = $("#contract_date").val();
        contract.contract_project = $('#contract_project').val();
        contract.contract_start = $("#contract_start_date").val();
        contract.contract_end = $("#contract_end_date").val();
        contract.amount = $('#amount').val();
        contract.remark = $('#remark').val();
        return contract;
    }
</script>


{%- endmacro %}